<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"></meta>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
    <title>Visual Admin Dashboard - Home</title>
    <meta name="description" content=""></meta>
    <meta name="author" content="templatemo"></meta>
    <!-- 
    Visual Admin Template
    http://www.templatemo.com/preview/templatemo_455_visual_admin
    -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,700' rel='stylesheet'
          type='text/css'></link>
    <link href="/css/font-awesome.min.css" rel="stylesheet"></link>
    <link href="/css/bootstrap.min.css" rel="stylesheet"></link>
    <link href="/css/templatemo-style.css" rel="stylesheet"></link>
    <link href="/css/toastr.css" rel="stylesheet"></link>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>
<!-- Left column -->
<div class="templatemo-flex-row">
    <div class="templatemo-sidebar">
        <header class="templatemo-site-header">
            <div class="square"></div>
            <h1>Visual Admin</h1>
        </header>
        <div class="profile-photo-container">
            <img src="/images/profile-photo.jpg" alt="Profile Photo" class="img-responsive"></img>
            <div class="profile-photo-overlay"></div>
        </div>
        <!-- Search box -->
        <form class="templatemo-search-form" role="search">
            <div class="input-group">
                <button type="submit" class="fa fa-search"></button>
                <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">
            </div>
        </form>
        <div class="mobile-menu-icon">
            <i class="fa fa-bars"></i>
        </div>
        <nav class="templatemo-left-nav">
            <ul>
                <li><a href="#" class="active"><i class="fa fa-home fa-fw"></i>Dashboard</a></li>
                <li><a href="data-visualization.html"><i class="fa fa-bar-chart fa-fw"></i>Charts</a></li>
                <li><a href="data-visualization.html"><i class="fa fa-database fa-fw"></i>Data Visualization</a></li>
                <li><a href="maps.html"><i class="fa fa-map-marker fa-fw"></i>Maps</a></li>
                <li><a href="manage-users.html"><i class="fa fa-users fa-fw"></i>Manage Users</a></li>
                <li><a href="preferences.html"><i class="fa fa-sliders fa-fw"></i>Preferences</a></li>
                <li><a href="login.html"><i class="fa fa-eject fa-fw"></i>Sign Out</a></li>
            </ul>
        </nav>
    </div>
    <!-- Main content -->
    <div class="templatemo-content col-1 light-gray-bg">
        <div class="templatemo-top-nav-container">
            <div class="row">
                <nav class="templatemo-top-nav col-lg-12 col-md-12">
                    <ul class="text-uppercase">
                        <li><a href="" class="active">Admin panel</a></li>
                        <li><a href="">Dashboard</a></li>
                        <li><a href="">Overview</a></li>
                        <li><a href="login.html">Sign in form</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="templatemo-content-container">
            <div class="templatemo-flex-row flex-content-row">
                <div class="templatemo-content-widget white-bg col-2">
                    <i class="fa fa-times"></i>
                    <div class="square"></div>
                    <h2 class="templatemo-inline-block">增加一个地址</h2>
                    <div style="float: right;">
                        <button type="button" class="btn btn-default" aria-label="Left Align">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                        </button>
                    </div>
                    <hr>
                    <p>Works on all major browsers. IE 10+. Visual Admin is <a
                            href="http://www.templatemo.com/tag/admin" target="_parent">free responsive admin
                        template</a> for everyone. Feel free to use this template for your backend user interfaces.
                        Please tell your friends about <a href="http://www.templatemo.com" target="_parent">templatemo.com</a>
                        website. You may <a href="http://www.templatemo.com/contact" target="_parent">contact us</a> if
                        you have anything to say.</p>
                    <div class="row form-group">
                        <div class="col-lg-6 col-md-6 form-group">
                            <label for="service-url">接口地址</label>
                            <input type="text" class="form-control" id="service-url" placeholder="url">
                        </div>
                        <div class="col-lg-6 col-md-6 form-group">
                            <label for="remark">描述</label>
                            <input type="text" class="form-control" id="remark" placeholder="写一些对这个接口ROOT的描述">
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 form-group">
                        <div>
                            <label class="control-label templatemo-block">什么设备 ?</label>
                            <div class="templatemo-block margin-bottom-5">
                                <input type="radio" name="deviceType-radio" id="r1" value="Android" checked>
                                <label for="r1" class="font-weight-400"><span></span>Android</label>
                            </div>
                            <div class="templatemo-block margin-bottom-5">
                                <input type="radio" name="deviceType-radio" id="r2" value="IOS">
                                <label for="r2" class="font-weight-400"><span></span>IOS</label>
                            </div>
                            <div class="templatemo-block margin-bottom-5">
                                <input type="radio" name="deviceType-radio" id="r3" value="其他">
                                <label for="r3" class="font-weight-400"><span></span>其他</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group text-right">
                        <button type="submit" class="templatemo-blue-button" onclick="insertServiceUrl()">Submit
                        </button>
                        <button type="reset" class="templatemo-white-button" onclick="resetInsert()">Reset</button>
                    </div>
                    <p>Nunc placerat purus eu tincidunt consequat. Lorem ipsum dolor sit amet, consectetur adipiscing
                        elit. Phasellus dapibus nulla quis risus auctor, non placerat augue consectetur. Fusce mi lacus,
                        semper sit amet mattis eu.</p>
                </div>

                <div class="templatemo-content-widget white-bg col-1 text-center">
                    <i class="fa fa-times"></i>
                    <h2 class="text-uppercase">Maris</h2>
                    <h3 class="text-uppercase margin-bottom-10">Design Project</h3>
                    <img src="/images/bicycle.jpg" alt="Bicycle" class="img-circle img-thumbnail"></img>
                </div>
                <div class="templatemo-content-widget white-bg col-1">
                    <i class="fa fa-times"></i>
                    <h2 class="text-uppercase">Dictum</h2>
                    <h3 class="text-uppercase">Sedvel Erat Non</h3>
                    <hr>
                    <div class="progress">
                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="100" style="width: 50%;"></div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
                    </div>
                </div>
            </div>
            <div class="templatemo-flex-row flex-content-row">
                <div class='col-1' id="widget-url-list">

                </div>
                <div class="col-1">
                    <div class="panel panel-default templatemo-content-widget white-bg no-padding templatemo-overflow-hidden">
                        <i class="fa fa-times"></i>
                        <div class="panel-heading templatemo-position-relative"><h2 class="text-uppercase">
                            接口维护列表</h2></div>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered">
                                <thead>
                                <tr>
                                    <td>No.</td>
                                    <td>支持类型</td>
                                    <td>接口ROOT</td>
                                    <td>更新时间</td>
                                    <td>操作</td>
                                </tr>
                                </thead>
                                <tbody id="urlservice-list-tbody">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- Second row ends -->
            <div class="templatemo-flex-row flex-content-row templatemo-overflow-hidden">
                <div class="col-1 templatemo-overflow-hidden">
                    <div class="templatemo-content-widget white-bg templatemo-overflow-hidden">
                        <i class="fa fa-times"></i>
                        <div class="templatemo-flex-row flex-content-row">
                            <div class="col-1 col-lg-6 col-md-12">
                                <h2 class="text-center">Modular<span class="badge">new</span></h2>
                                <div id="pie_chart_div" class="templatemo-chart"></div> <!-- Pie chart div -->
                            </div>
                            <div class="col-1 col-lg-6 col-md-12">
                                <h2 class="text-center">Interactive<span class="badge">new</span></h2>
                                <div id="bar_chart_div" class="templatemo-chart"></div> <!-- Bar chart div -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="text-right">
                <p>Copyright &copy; 2084 Company Name
                    | Designed by <a href="http://www.templatemo.com" target="_parent">templatemo</a></p>
            </footer>
        </div>
    </div>
</div>

<!-- JS -->
<script src="/js/jquery-1.11.2.min.js"></script>
<script src="/js/toastr.js"></script> <!-- jQuery -->
<script src="/layer/layer.js"></script> <!-- jQuery Layer -->
<script src="/js/jquery-migrate-1.2.1.min.js"></script> <!--  jQuery Migrate Plugin -->
<script type="text/javascript" src="/js/templatemo-script.js"></script>      <!-- Templatemo Script -->
<script type="text/javascript">
    $(function () {
        initUrlServiceList();
    });

    function initUrlServiceList() {
        $.ajax({
            url: 'list-url',
            type: 'POST', //GET
            async: true,    //或false,是否异步
            timeout: 5000,    //超时时间
            dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data)
                console.log(textStatus)
                console.log(jqXHR)

                $("#urlservice-list-tbody").empty();
                $("#widget-url-list").empty();

                for (var i = 0; i < data.length; i++) {
                    var obj = data[i];
                    var row = "<tr><td>" + obj.id + "</td><td>" + obj.deviceType + "</td><td>" + obj.url + "</td><td>" + obj.updateTime + "</td><td><button onclick='deleteServiceUrl(" + obj.id + ")'>删除</button><button onclick='alertUpdateWindow(" + obj.id + ")'>编辑</button></td></tr>";

                    $("#urlservice-list-tbody").append(row);

                    var template0 = "<div class='templatemo-content-widget orange-bg'> <i class='fa fa-times' onclick='deleteServiceUrl(" + obj.url + ")'></i> <div class='media'> <div class='media-left'> <a href='#'> <img class='media-object img-circle' src='/images/sunset.jpg' alt='Sunset'></img> </a> </div> <div class='media-body'> <h2 class='media-heading text-uppercase'>设备类型 : " + obj.deviceType + "<br/><br/>描述 : " + obj.remark + "</h2> <a style='font-size: 30px;' href='" + obj.url + "'>" + obj.url + "</a> <div style='float: right;'> <button type='button' class='btn btn-default' aria-label='Left Align' onclick='firstChoiceUrl(" + obj.id + ")'> <span class='glyphicon glyphicon-arrow-up' aria-hidden='true'></span> </button> </div> </div> </div> </div>";
                    var template1 = "<div class='templatemo-content-widget white-bg'><i class='fa fa-times' onclick='deleteServiceUrl(" + obj.url + ")'></i><div class='media'> <div class='media-left'> <a href='#'> <img class='media-object img-circle' src='/images/sunset.jpg'alt='Sunset'></img></img> </a> </div> <div class='media-body'> <h2 class='media-heading text-uppercase'>设备类型 : " + obj.deviceType + "<br/><br/>描述 : " + obj.remark + "</h2> <a style='font-size: 30px;'  href='" + obj.url + "'>" + obj.url + "</a> <div style='float: right;'> <button type='button' class='btn btn-default' aria-label='Left Align' onclick='firstChoiceUrl(" + obj.id + ")'> <span class='glyphicon glyphicon-arrow-up' aria-hidden='true'></span> </button> </div> </div> </div> </div>";

                    if (i <= 2)
                        if (i % 2 == 0)
                            $("#widget-url-list").append(template0);
                        else
                            $("#widget-url-list").append(template1);

                }
            },
        })
    }

    function resetInsert(t) {

        if (t == 'u') {
            $("#u-remark").val("");
            $("#u-service-url").val("");
            layer.msg("好了 , 我清除更新表单了 /");
            return false;
        }

        $("#remark").val("");
        $("#service-url").val("");

        if (t == undefined || t == null || t == '') {
            layer.msg("好了 , 我清除表单了 /");
        }
    }

    function alertTopTip(type, msg) {
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "positionClass": "toast-top-right",
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
        if (type == 'success') {
            toastr.success(msg);
        }
        if (type == "error") {
            toastr.error(msg);
        }
    }

    function findByOne(id) {
        var data2 = {};
        $.ajax({
            url: 'findById-url',
            type: 'POST', //GET
            async: false,    //或false,是否异步
            timeout: 5000,    //超时时间
            data: {
                'id': id
            },
            dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data)
                data2 = data;
            },
        });
        return data2;
    }
    var updateWindowContext;

    function alertUpdateWindow(id) {
        console.log(id);
        updateWindowContext = layer.open({
            type: 1,
            area: ['500px', '460px'],
            shadeClose: true, //点击遮罩关闭
            content: $("#edit-template"),
        });

        var serviceUrl = findByOne(id);
        console.log(serviceUrl.url);
        console.log(serviceUrl.remark);
        console.log(serviceUrl.deviceType);

        $("#u-remark").val(serviceUrl.remark);
        $("#u-service-url").val(serviceUrl.url);
        $("#u-deviceType").val(serviceUrl.deviceType);
        $("#u-id").val(id);
    }



    function updateServiceUrl() {

        var remark = $("#u-remark").val();
        var uServiceUrl = $("#u-service-url").val();
        var uDeviceType = $("#u-deviceType").val();
        var uId = $("#u-id").val();

        $.ajax({
            url: 'update-url',
            type: 'POST', //GET
            async: true,    //或false,是否异步
            timeout: 5000,    //超时时间
            data: {
                'id': uId,
                'remark': remark,
                'url': uServiceUrl,
                'deviceType': uDeviceType
            },
            dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data)
                if (data.code = 200) {
                    alertTopTip("success", "成功更新 , 即将刷新列表!");
                    resetInsert("y");
                    initUrlServiceList();
                    layer.close(updateWindowContext);

                } else {
                    alertTopTip("error", "出现错误，检查网络或者联系管理员!");
                }
            },
        })
    }

    function deleteServiceUrl(id) {
        if (confirm("你真的要删除这个?")) {

            $.ajax({
                url: 'delete-url',
                type: 'POST', //GET
                async: true,    //或false,是否异步
                timeout: 5000,    //超时时间
                data: {
                    'id': id,
                },
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                success: function (data, textStatus, jqXHR) {
                    console.log(data.code)
                    if (data.code = 200) {
                        alertTopTip("success", "删除成功 !");
                        initUrlServiceList();
                    } else {
                        alertTopTip("error", "出现错误，检查网络或者联系管理员!");
                    }
                },
            })
        }
        else {
            alertTopTip("success", "取消了删除!");
        }
    }

    function firstChoiceUrl(id) {
        $.ajax({
            url: 'set-upChoice-url',
            type: 'POST', //GET
            async: true,    //或false,是否异步
            timeout: 5000,    //超时时间
            data: {
                'id': id,
            },
            dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data.code)
                if (data.code = 200) {
                    alertTopTip("success", "首选地址已经更新成功 . 重启APP . 即将刷新列表!");
                    initUrlServiceList();
                } else {
                    alertTopTip("error", "出现错误，检查网络或者联系管理员!");
                }
            },
        })
    }


    function insertServiceUrl() {
        var remark = $("#remark").val();
        var url = $("#service-url").val();
        var deviceType = $('input:radio[name="deviceType-radio"]:checked').val();

        if (url == '' || remark == '' || deviceType == '') {
            alertTopTip("error", "出现错误，请更改 , (填写接口地址或描述)");
            return false;
        }
        $.ajax({
            url: 'insert-url',
            type: 'POST', //GET
            async: true,    //或false,是否异步
            timeout: 5000,    //超时时间
            data: {
                'remark': remark,
                'url': url,
                'deviceType': deviceType
            },
            dataType: 'text',    //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data, textStatus, jqXHR) {
                console.log(data)
                if (data = 'success') {
                    alertTopTip("success", "成功 , 即将刷新列表!");
                    resetInsert("y");
                    initUrlServiceList();
                } else {
                    alertTopTip("error", "出现错误，检查网络或者联系管理员!");
                }
            },
        })
    }

</script>
</body>
<div class="templatemo-content-widget white-bg col-2" id="edit-template" style="display: none;">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <form class="form-horizontal">
                    <div class="control-group">
                        <label class="control-label" for="u-service-url">接口前缀</label>
                        <div class="controls">
                            <input id="u-id" type="text" style="display: none;"/>
                            <input id="u-service-url" type="text" size="30"/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="u-remark">接口描述</label>
                        <div class="controls">
                            <input id="u-remark" type="text" size="30"/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="u-deviceType">什么设备 ? </label>
                        <div class="controls">
                            <select id="u-deviceType">
                                <option>Android</option>
                                <option>IOS</option>
                                <option>其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                            <label class="checkbox"><input type="checkbox"/> 你这确定要去更新么?</label>
                            <button type="button" class="btn" style="float: right;" onclick="updateServiceUrl()">更新</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</html>